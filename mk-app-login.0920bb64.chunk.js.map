{"version":3,"sources":["webpack:///./apps/login/component.js","webpack:///./apps/login/action.js","webpack:///./apps/login/reducer.js"],"names":["_react","__webpack_require__","_mkMetaEngine","C","wrapper","appInfo","this","props","monkeyKing","_extends3","default","path","Component","option","metaAction","MetaAction","o","action","ret","config","metaHandlers","_this","_classCallCheck3","onInit","_ref","component","injections","reduce","getLogo","logo","login","_asyncToGenerator3","_regenerator2","mark","_callee","form","response","wrap","_context","prev","next","gf","toJS","check","value","mobile","password","sent","abrupt","webapi","user","context","set","onRedirect","goAfterLogin","stop","goRegister","apps","goForgot","fieldChange","_ref3","_callee2","fieldPath","_context2","_x","_x2","apply","arguments","_ref4","_callee3","fieldPathAndValues","checkResults","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","r","json","hasError","_context3","undefined","_getIterator3","done","t0","_assign2","t1","checkMobile","t2","t3","t4","checkPassword","t5","push","t6","return","finish","forEach","errorPath","message","sfs","_x3","_ref5","_callee4","_context4","_x4","_ref6","_callee5","_context5","_x5","current","metaReducer","MetaReducer","reducer","_data","init","state","getInitState"],"mappings":"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","file":"mk-app-login.0920bb64.chunk.js","sourcesContent":["import React, { Component } from 'react'\n\nimport { wrapper } from 'mk-meta-engine'\n\nimport appInfo from './index'\n\n@wrapper(appInfo)\nexport default class C extends Component {\n\trender() {\n\t\treturn this.props.monkeyKing({ ...this.props, path: 'root' })\n\t}\n}","import React from 'react'\nimport { action as MetaAction, AppLoader } from 'mk-meta-engine'\nimport config from './config'\n\nclass action {\n    constructor(option) {\n        this.metaAction = option.metaAction\n        this.config = config.current\n        this.webapi = this.config.webapi\n    }\n\n    onInit = ({ component, injections }) => {\n        this.component = component\n        this.injections = injections\n        injections.reduce('init')\n    }\n\n    getLogo = () => this.config.logo\n\n    login = async () => {\n        const form = this.metaAction.gf('data.form').toJS()\n\n        const ok = await this.check([{\n            path: 'data.form.mobile', value: form.mobile\n        }, {\n            path: 'data.form.password', value: form.password\n        }])\n\n        if (!ok) return\n\n        const response = await this.webapi.user.login(form)\n        this.metaAction.context.set('currentUser', response)\n\n        if (this.component.props.onRedirect && this.config.goAfterLogin) {\n            this.component.props.onRedirect(this.config.goAfterLogin)\n        }\n    }\n\n    goRegister = () => {\n        if(!this.config.apps['mk-app-register']){\n            throw '请将这个应用加入到带mk-app-root和mk-app-register的网站中，跳转功能才能正常使用'\n        }\n        if (this.component.props.onRedirect && this.config.goRegister) {\n            this.component.props.onRedirect(this.config.goRegister)\n        }\n    }\n\n    goForgot = () =>{\n        if(!this.config.apps['mk-app-forgot-password']){\n            throw '请将这个应用加入到带mk-app-root和mk-app-forgot-password的网站中，跳转功能才能正常使用'\n        }\n        if (this.component.props.onRedirect && this.config.goForgot) {\n            this.component.props.onRedirect(this.config.goForgot)\n        }\n    }\n\n    fieldChange = async (fieldPath, value) => {\n        await this.check([{ path: fieldPath, value }])\n    }\n\n    check = async (fieldPathAndValues) => {\n        if (!fieldPathAndValues)\n            return\n\n        var checkResults = []\n\n        for (var o of fieldPathAndValues) {\n            let r = { ...o }\n            if (o.path == 'data.form.mobile') {\n                Object.assign(r, await this.checkMobile(o.value))\n            }\n            else if (o.path == 'data.form.password') {\n                Object.assign(r, await this.checkPassword(o.value))\n            }\n            checkResults.push(r)\n        }\n\n        var json = {}\n        var hasError = true\n        checkResults.forEach(o => {\n            json[o.path] = o.value\n            json[o.errorPath] = o.message\n            if (o.message)\n                hasError = false\n        })\n\n        this.metaAction.sfs(json)\n\n        return hasError\n    }\n\n\n    checkMobile = async (mobile) => {\n        var message\n\n        if (!mobile)\n            message = '请录入账号号'\n       /* else if (!/^1[3|4|5|8][0-9]\\d{8}$/.test(mobile))\n            message = '请录入有效的手机号'*/\n\n        return { errorPath: 'data.other.error.mobile', message }\n    }\n\n    checkPassword = async (password) => {\n        var message\n\n        if (!password)\n            message = '请录入密码'\n\n        return { errorPath: 'data.other.error.password', message }\n    }\n}\n\nexport default function creator(option) {\n    const metaAction = new MetaAction(option),\n        o = new action({ ...option, metaAction }),\n        ret = { ...metaAction, ...o }\n\n    metaAction.config({ metaHandlers: ret })\n\n    return ret\n}","import { Map } from 'immutable'\nimport { reducer as MetaReducer } from 'mk-meta-engine'\nimport config from './config'\nimport { getInitState } from './data'\n\nclass reducer {\n    constructor(option) {\n        this.metaReducer = option.metaReducer\n    }\n\n    init = (state, option) => {\n        return this.metaReducer.init(state, getInitState())\n    }\n}\n\nexport default function creator(option) {\n    const metaReducer = new MetaReducer(option),\n        o = new reducer({ ...option, metaReducer })\n\n    return { ...metaReducer, ...o }\n}"],"sourceRoot":""}