{"version":3,"sources":["webpack:///./apps/portal/component.js","webpack:///./apps/portal/action.js","webpack:///./apps/portal/reducer.js","webpack:///./apps/portal/img/photo.png"],"names":["_react","__webpack_require__","_mkMetaEngine","C","wrapper","appInfo","this","props","monkeyKing","_extends3","default","path","Component","option","metaAction","MetaAction","o","action","ret","config","metaHandlers","_immutable","_mkUtils","_this","_classCallCheck3","onInit","_ref","component","injections","reduce","load","history","listen","childApp","location","currentAppName","gf","targetAppName","setContent","componentWillUnmount","unlisten","_asyncToGenerator3","_regenerator2","mark","_callee","user","response","wrap","_context","prev","next","apps","id","mobile","nickname","context","set","sf","fromJS","abrupt","webapi","portal","init","sent","undefined","onRedirect","goAfterLogout","menu","stop","getLogo","logo","getPhoto","require","getCurrentUser","get","getMenuChildren","_isMeta","value","loop","children","level","forEach","child","ele","name","key","icon","title","type","push","toJS","topMenuClick","_ref3","_callee2","e","_context2","t0","logout","window","open","_x","apply","arguments","menuClick","hit","find","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","_getIterator3","done","err","return","appName","appParams","issueClick","getMenuSelectKeys","content","tabChange","curr","tabEdit","appProps","foldMenu","setTimeout","event","document","createEvent","initEvent","dispatchEvent","current","metaReducer","MetaReducer","reducer","_data","state","getInitState","getMenu","lenght","defaultMenuItem","firstMenuItem","defaultOpens","menuKeyNameMap","menuAppNameMap","isExpand","isDefault","menuSelectedKeys","menuDefaultOpenKeys","map","defaultContent","getChildApp","currContent","getIn","openTabs","List","findIndex","isTabsStyle","pushChildApp","closeContent","hitIndex","remove","size","closeAll","Map","module","exports","p"],"mappings":"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","file":"mk-app-portal.0920bb64.chunk.js","sourcesContent":["import React, { Component } from 'react'\n\nimport { wrapper } from 'mk-meta-engine'\n\nimport appInfo from './index'\n\n@wrapper(appInfo)\nexport default class C extends Component {\n\trender() {\n\t\treturn this.props.monkeyKing({ ...this.props, path: 'root' })\n\t}\n}","import React from 'react'\nimport { Menu } from 'mk-component'\nimport { action as MetaAction, AppLoader } from 'mk-meta-engine'\nimport { fromJS } from 'immutable'\nimport { history } from 'mk-utils'\nimport config from './config'\n\nclass action {\n    constructor(option) {\n        this.metaAction = option.metaAction\n        this.config = config.current\n        this.webapi = this.config.webapi\n    }\n\n    onInit = ({ component, injections }) => {\n        this.component = component\n        this.injections = injections\n        injections.reduce('init')\n\n        this.load()\n\n        //history增加\n        history.listen('mk-app-portal', this.listen)\n    }\n\n    //history增加\n    listen = (childApp, location, action) => {\n        const currentAppName = this.metaAction.gf('data.content.appName')\n        const targetAppName = childApp\n        if (!targetAppName) {\n            this.injections.reduce('closeAll')\n            return\n        }\n\n        if (targetAppName == currentAppName) {\n            return\n        }\n\n        this.setContent('', targetAppName)\n    }\n\n\n    componentWillUnmount = () => {\n        history.unlisten('mk-app-portal', this.listen)\n    }\n\n\n    load = async () => {\n        //网站中不存在login应用，那么就不做用户相关处理，正式环境应该不需要这段代码，仅为单应用运行使用\n        if (!this.config.apps['mk-app-login']) {\n            const user = { id: 1, mobile: '13334445556', nickname: '齐天大圣' }\n            this.metaAction.context.set('currentUser', user)\n            this.metaAction.sf('data.other.currentUser', fromJS(user))\n            return\n        }\n\n        const response = await this.webapi.portal.init()\n\n        if (response.user) {\n            this.metaAction.context.set('currentUser', response.user)\n            this.metaAction.sf('data.other.currentUser', fromJS(response.user))\n        }\n        else {\n            this.metaAction.context.set('currentUser', undefined)\n            if (this.component.props.onRedirect && this.config.goAfterLogout) {\n                this.component.props.onRedirect(this.config.goAfterLogout)\n            }\n        }\n\n        if (response.menu) {\n            this.injections.reduce('load', { menu: response.menu })\n        }\n        /*\n        如果菜单从ajax获取，那么使用下面的方式\n        if (this.webapi.getMenu) {\n            const menu = await this.webapi.getMenu()\n            this.injections.reduce('load', {menu})\n        }*/\n    }\n\n    getLogo = () => this.config.logo\n\n    getPhoto = () => require('./img/photo.png')\n\n    getCurrentUser = () => this.metaAction.context.get('currentUser') || {}\n\n    getMenuChildren = () => {\n        const menu = this.metaAction.gf('data.menu').toJS()\n\n        const loop = (children, level) => {\n            const ret = []\n            children.forEach(child => {\n                \n                let ele = {\n                    name: child.key,\n                    key: child.key\n                }\n\n                if (!child.children) {\n                    ele.component  = 'Menu.Item'\n\n                    if (child.icon || level == 1) {\n                        ele.children = [{\n                            name: 'icon',\n                            component: 'Icon',\n                            type: child.icon || 'desktop'\n                        }, {\n                            name: 'name',\n                            component: '::span',\n                            children: child.name\n                        }]\n                    }\n                    else {\n                        ele.children = child.name\n                    }\n                }\n                else {\n                    ele.component  = 'Menu.SubMenu'\n                    ele.children = loop(child.children, level + 1)\n\n                    if (child.icon || level == 1) {\n                        ele.title = [{\n                            name: 'icon',\n                            component: 'Icon',\n                            type: child.icon || 'desktop'\n                        }, {\n                            name: 'name',\n                            component: '::span',\n                            children: child.name\n                        }]\n                    }\n                    else {\n                        ele.title = child.name\n                    }\n                }\n\n                ret.push(ele)\n            })\n            return ret\n        }\n        return {\n            _isMeta: true,\n            value: loop(menu, 1)\n        }\n\n    }\n\n    topMenuClick = async (e) => {\n        switch (e.key) {\n            case 'logout':\n                if (this.component.props.onRedirect && this.config.goAfterLogout) {\n                    await this.webapi.user.logout()\n                    this.metaAction.context.set('currentUser', undefined)\n                    this.component.props.onRedirect(this.config.goAfterLogout)\n                }\n                break;\n            case 'github':\n                window.open('https://www.github.com/ziaochina/mk-demo')\n                break;\n            case 'gitter':\n                window.open('https://gitter.im/mk-js/mk-js?utm_source=share-link&utm_medium=link&utm_campaign=share-link')\n                break;\n            case 'mySetting':\n                if (!this.config.apps['mk-app-my-setting'])\n                    throw '不存在mk-app-my-setting应用，该功能不能使用'\n\n                this.setContent('个人设置', 'mk-app-my-setting')\n                break;\n            case 'toggleTabs':\n                this.metaAction.sf('data.isTabsStyle', !this.metaAction.gf('data.isTabsStyle'))\n        }\n    }\n\n\n    menuClick = (e) => {\n        const menu = this.metaAction.gf('data.menu').toJS()\n        const find = (children) => {\n            for (let child of children) {\n                if (child.key == e.key) {\n                    return child\n                }\n                if (child.children) {\n                    let o = find(child.children)\n                    if (o) return o\n                }\n            }\n        }\n\n        const hit = find(menu)\n        if (hit) {\n            this.setContent(hit.name, hit.appName, hit.appParams)\n        }\n    }\n    \n    issueClick = () => {\n        window.open('https://github.com/ziaochina/mk-demo/issues/new')\n    }\n\n    getMenuSelectKeys = () => {\n        const content = this.metaAction.gf('data.content')\n        if (!content) return\n        const menuKeyNameMap = this.metaAction.gf('data.menuKeyNameMap')\n        return [menuKeyNameMap.get(content.get('name'))]\n    }\n    tabChange = (key) => {\n        const openTabs = this.metaAction.gf('data.openTabs')\n        const curr = openTabs.find(o => o.get('name') == key)\n        this.setContent(curr.get('name'), curr.get('appName'), curr.get('appProps'))\n    }\n\n    tabEdit = (key, action) => {\n        if (action == 'remove') {\n            this.injections.reduce('closeContent', key)\n        }\n    }\n\n    setContent = (name, appName, appProps) => {\n        this.injections.reduce('setContent', name, appName, appProps)\n    }\n\n    foldMenu = () => {\n        this.metaAction.sf('data.isFoldMenu', !this.metaAction.gf('data.isFoldMenu'))\n        setTimeout(function () {\n            var event = document.createEvent('HTMLEvents')\n            event.initEvent(\"resize\", true, true)\n            window.dispatchEvent(event)\n        }, 0)\n    }\n}\n\nexport default function creator(option) {\n    const metaAction = new MetaAction(option),\n        o = new action({ ...option, metaAction }),\n        ret = { ...metaAction, ...o }\n\n    metaAction.config({ metaHandlers: ret })\n\n    return ret\n}\n","import { Map, List, fromJS } from 'immutable'\nimport { reducer as MetaReducer } from 'mk-meta-engine'\nimport config from './config'\nimport { getInitState } from './data'\nimport { history } from 'mk-utils'\n\nclass reducer {\n    constructor(option) {\n        this.metaReducer = option.metaReducer\n        this.config = config.current\n    }\n\n    init = (state, option) => {\n        state = this.metaReducer.init(state, getInitState())\n\n        if (this.config.menu && !this.config.webapi.getMenu) {\n            return this.load(state, { menu: this.config.menu })\n        }\n\n        return state\n    }\n\n    load = (state, { menu }) => {\n        if (!menu || menu.lenght == 0)\n            return state\n\n        var defaultMenuItem, firstMenuItem, defaultOpens = [], menuKeyNameMap = {}, menuAppNameMap = {}\n\n        const loop = (children) => {\n            const ret = []\n            children.forEach(child => {\n                menuKeyNameMap[child.name] = child.key\n\n                //history增加\n                if (child.appName) {\n                    menuAppNameMap[child.appName] = {\n                        name: child.name,\n                        props: child.appParams || {}\n                    }\n                }\n\n                if (!child.children) {\n                    if (!firstMenuItem) {\n                        firstMenuItem = child\n                    }\n\n                    if (child.isDefault) {\n                        defaultMenuItem = child\n                    }\n                }\n                else {\n                    if (child.isExpand) {\n                        defaultOpens.push(child)\n                    }\n\n                    loop(child.children)\n                }\n            })\n            return ret\n        }\n\n        loop(menu)\n\n        defaultMenuItem = defaultMenuItem || firstMenuItem\n\n        const menuSelectedKeys = fromJS(defaultMenuItem ? [defaultMenuItem.key] : [])\n        const menuDefaultOpenKeys = fromJS(defaultOpens.map(o => o.key))\n        const defaultContent = defaultMenuItem ? defaultMenuItem : {}\n\n        state = this.metaReducer.sf(state, 'data.menu', fromJS(menu))\n        state = this.metaReducer.sf(state, 'data.menuKeyNameMap', fromJS(menuKeyNameMap))\n        state = this.metaReducer.sf(state, 'data.menuAppNameMap', fromJS(menuAppNameMap))\n        state = this.metaReducer.sf(state, 'data.menuSelectedKeys', menuSelectedKeys)\n        state = this.metaReducer.sf(state, 'data.menuDefaultOpenKeys', menuDefaultOpenKeys)\n\n        const childApp = history.getChildApp('mk-app-portal')\n        if (childApp)\n            return this.setContent(state, '', childApp)\n        else\n            return this.setContent(state, defaultContent.name, defaultContent.appName, defaultContent.appProps)\n    }\n\n    setContent = (state, name, appName, appProps) => {\n        //判断当前显示页签appName和要新打开的是否一致\n        const currContent = this.metaReducer.gf(state, 'data.content')\n        if (currContent && appName == currContent.get('appName'))\n            return state\n\n        //history增加\n        let menuAppNameMap = this.metaReducer.gf(state, 'data.menuAppNameMap')\n        if (name && appName && menuAppNameMap.getIn([appName, 'name']) != name) {\n            menuAppNameMap = menuAppNameMap.set(appName, fromJS({ name, props: appProps }))\n            state = this.metaReducer.sf(state, 'data.menuAppNameMap', menuAppNameMap)\n        }\n\n        name = menuAppNameMap.getIn([appName, 'name'])\n        appProps = appProps || menuAppNameMap.getIn([appName, 'props'])\n\n        const content = fromJS({ name, appName, appProps })\n        state = this.metaReducer.sf(state, 'data.content', content)\n\n        var openTabs = this.metaReducer.gf(state, 'data.openTabs') || List()\n        var hit = openTabs.findIndex(o => o.get('name') == name || o.get('appName') == appName) != -1\n        const isTabsStyle = this.metaReducer.gf(state, 'data.isTabsStyle')\n\n        if (!hit) {\n            if (isTabsStyle)\n                openTabs = openTabs.push(content)\n            else\n                openTabs = List().push(content)\n            state = this.metaReducer.sf(state, 'data.openTabs', openTabs)\n        }\n        else {\n            if (!isTabsStyle) {\n                openTabs = List().push(content)\n                state = this.metaReducer.sf(state, 'data.openTabs', openTabs)\n            }\n        }\n\n        setTimeout(() => {\n            history.pushChildApp('mk-app-portal', content.get('appName'))\n        }, 0)\n\n        return state\n    }\n\n    closeContent = (state, name) => {\n        var openTabs = this.metaReducer.gf(state, 'data.openTabs') || List()\n        var hitIndex = openTabs.findIndex(o => o.get('name') == name)\n        openTabs = openTabs.remove(hitIndex)\n        state = this.metaReducer.sf(state, 'data.openTabs', openTabs)\n        return this.metaReducer.sf(state, 'data.content', openTabs.get(openTabs.size - 1))\n    }\n\n    closeAll = (state) => {\n        state = this.metaReducer.sf(state, 'data.openTabs', new List())\n        return this.metaReducer.sf(state, 'data.content', new Map())\n    }\n}\n\nexport default function creator(option) {\n    const metaReducer = new MetaReducer(option),\n        o = new reducer({ ...option, metaReducer })\n\n    return { ...metaReducer, ...o }\n}","module.exports = __webpack_public_path__ + \"photo.36d29d9e.png\";"],"sourceRoot":""}