(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1567:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,r=d(n(2)),o=d(n(43)),i=d(n(4)),u=d(n(8)),c=d(n(3)),s=d(n(5)),p=n(1),m=(d(p),n(955)),f=d(n(1510));function d(e){return e&&e.__esModule?e:{default:e}}var l=(0,m.wrapper)(f.default)(a=function(e){function t(){return(0,i.default)(this,t),(0,c.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,u.default)(t,[{key:"render",value:function(){return this.props.monkeyKing((0,r.default)({},this.props,{path:"root"}))}}]),t}(p.Component))||a;t.default=l,e.exports=t.default},1568:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=f(n(2)),r=f(n(77)),o=f(n(956)),i=f(n(957)),u=f(n(4));t.default=function(e){var t=new c.action(e),n=new d((0,a.default)({},e,{metaAction:t})),r=(0,a.default)({},t,n);return t.config({metaHandlers:r}),r};f(n(1)),n(953);var c=n(955),s=n(58),p=n(49),m=f(n(1494));function f(e){return e&&e.__esModule?e:{default:e}}var d=function e(t){var a=this;(0,u.default)(this,e),this.onInit=function(e){var t=e.component,n=e.injections;a.component=t,a.injections=n,n.reduce("init"),a.load(),p.history.listen("mk-app-portal",a.listen)},this.listen=function(e,t,n){var r=a.metaAction.gf("data.content.appName"),o=e;o?o!=r&&a.setContent("",o):a.injections.reduce("closeAll")},this.componentWillUnmount=function(){p.history.unlisten("mk-app-portal",a.listen)},this.load=(0,i.default)(o.default.mark(function e(){var t,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.config.apps["mk-app-login"]){e.next=5;break}return t={id:1,mobile:"13334445556",nickname:"齐天大圣"},a.metaAction.context.set("currentUser",t),a.metaAction.sf("data.other.currentUser",(0,s.fromJS)(t)),e.abrupt("return");case 5:return e.next=7,a.webapi.portal.init();case 7:(n=e.sent).user?(a.metaAction.context.set("currentUser",n.user),a.metaAction.sf("data.other.currentUser",(0,s.fromJS)(n.user))):(a.metaAction.context.set("currentUser",void 0),a.component.props.onRedirect&&a.config.goAfterLogout&&a.component.props.onRedirect(a.config.goAfterLogout)),n.menu&&a.injections.reduce("load",{menu:n.menu});case 10:case"end":return e.stop()}},e,a)})),this.getLogo=function(){return a.config.logo},this.getPhoto=function(){return n(1728)},this.getCurrentUser=function(){return a.metaAction.context.get("currentUser")||{}},this.getMenuChildren=function(){return{_isMeta:!0,value:function e(t,n){var a=[];return t.forEach(function(t){var r={name:t.key,key:t.key};t.children?(r.component="Menu.SubMenu",r.children=e(t.children,n+1),t.icon||1==n?r.title=[{name:"icon",component:"Icon",type:t.icon||"desktop"},{name:"name",component:"::span",children:t.name}]:r.title=t.name):(r.component="Menu.Item",t.icon||1==n?r.children=[{name:"icon",component:"Icon",type:t.icon||"desktop"},{name:"name",component:"::span",children:t.name}]:r.children=t.name),a.push(r)}),a}(a.metaAction.gf("data.menu").toJS(),1)}},this.topMenuClick=function(){var e=(0,i.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.key,e.next="logout"===e.t0?3:"github"===e.t0?9:"gitter"===e.t0?11:"mySetting"===e.t0?13:"toggleTabs"===e.t0?17:18;break;case 3:if(!a.component.props.onRedirect||!a.config.goAfterLogout){e.next=8;break}return e.next=6,a.webapi.user.logout();case 6:a.metaAction.context.set("currentUser",void 0),a.component.props.onRedirect(a.config.goAfterLogout);case 8:return e.abrupt("break",18);case 9:return window.open("https://www.github.com/ziaochina/mk-demo"),e.abrupt("break",18);case 11:return window.open("https://gitter.im/mk-js/mk-js?utm_source=share-link&utm_medium=link&utm_campaign=share-link"),e.abrupt("break",18);case 13:if(a.config.apps["mk-app-my-setting"]){e.next=15;break}throw"不存在mk-app-my-setting应用，该功能不能使用";case 15:return a.setContent("个人设置","mk-app-my-setting"),e.abrupt("break",18);case 17:a.metaAction.sf("data.isTabsStyle",!a.metaAction.gf("data.isTabsStyle"));case 18:case"end":return e.stop()}},e,a)}));return function(t){return e.apply(this,arguments)}}(),this.menuClick=function(e){var t=function t(n){var a=!0,o=!1,i=void 0;try{for(var u,c=(0,r.default)(n);!(a=(u=c.next()).done);a=!0){var s=u.value;if(s.key==e.key)return s;if(s.children){var p=t(s.children);if(p)return p}}}catch(e){o=!0,i=e}finally{try{!a&&c.return&&c.return()}finally{if(o)throw i}}}(a.metaAction.gf("data.menu").toJS());t&&a.setContent(t.name,t.appName,t.appParams)},this.issueClick=function(){window.open("https://github.com/ziaochina/mk-demo/issues/new")},this.getMenuSelectKeys=function(){var e=a.metaAction.gf("data.content");if(e)return[a.metaAction.gf("data.menuKeyNameMap").get(e.get("name"))]},this.tabChange=function(e){var t=a.metaAction.gf("data.openTabs").find(function(t){return t.get("name")==e});a.setContent(t.get("name"),t.get("appName"),t.get("appProps"))},this.tabEdit=function(e,t){"remove"==t&&a.injections.reduce("closeContent",e)},this.setContent=function(e,t,n){a.injections.reduce("setContent",e,t,n)},this.foldMenu=function(){a.metaAction.sf("data.isFoldMenu",!a.metaAction.gf("data.isFoldMenu")),setTimeout(function(){var e=document.createEvent("HTMLEvents");e.initEvent("resize",!0,!0),window.dispatchEvent(e)},0)},this.metaAction=t.metaAction,this.config=m.default.current,this.webapi=this.config.webapi};e.exports=t.default},1569:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=p(n(2)),r=p(n(4));t.default=function(e){var t=new i.reducer(e),n=new m((0,a.default)({},e,{metaReducer:t}));return(0,a.default)({},t,n)};var o=n(58),i=n(955),u=p(n(1494)),c=n(1511),s=n(49);function p(e){return e&&e.__esModule?e:{default:e}}var m=function e(t){var n=this;(0,r.default)(this,e),this.init=function(e,t){return e=n.metaReducer.init(e,(0,c.getInitState)()),n.config.menu&&!n.config.webapi.getMenu?n.load(e,{menu:n.config.menu}):e},this.load=function(e,t){var a=t.menu;if(!a||0==a.lenght)return e;var r,i,u=[],c={},p={};!function e(t){return t.forEach(function(t){c[t.name]=t.key,t.appName&&(p[t.appName]={name:t.name,props:t.appParams||{}}),t.children?(t.isExpand&&u.push(t),e(t.children)):(i||(i=t),t.isDefault&&(r=t))}),[]}(a),r=r||i;var m=(0,o.fromJS)(r?[r.key]:[]),f=(0,o.fromJS)(u.map(function(e){return e.key})),d=r||{};e=n.metaReducer.sf(e,"data.menu",(0,o.fromJS)(a)),e=n.metaReducer.sf(e,"data.menuKeyNameMap",(0,o.fromJS)(c)),e=n.metaReducer.sf(e,"data.menuAppNameMap",(0,o.fromJS)(p)),e=n.metaReducer.sf(e,"data.menuSelectedKeys",m),e=n.metaReducer.sf(e,"data.menuDefaultOpenKeys",f);var l=s.history.getChildApp("mk-app-portal");return l?n.setContent(e,"",l):n.setContent(e,d.name,d.appName,d.appProps)},this.setContent=function(e,t,a,r){var i=n.metaReducer.gf(e,"data.content");if(i&&a==i.get("appName"))return e;var u=n.metaReducer.gf(e,"data.menuAppNameMap");t&&a&&u.getIn([a,"name"])!=t&&(u=u.set(a,(0,o.fromJS)({name:t,props:r})),e=n.metaReducer.sf(e,"data.menuAppNameMap",u)),t=u.getIn([a,"name"]),r=r||u.getIn([a,"props"]);var c=(0,o.fromJS)({name:t,appName:a,appProps:r});e=n.metaReducer.sf(e,"data.content",c);var p=n.metaReducer.gf(e,"data.openTabs")||(0,o.List)(),m=-1!=p.findIndex(function(e){return e.get("name")==t||e.get("appName")==a}),f=n.metaReducer.gf(e,"data.isTabsStyle");return m?f||(p=(0,o.List)().push(c),e=n.metaReducer.sf(e,"data.openTabs",p)):(p=f?p.push(c):(0,o.List)().push(c),e=n.metaReducer.sf(e,"data.openTabs",p)),setTimeout(function(){s.history.pushChildApp("mk-app-portal",c.get("appName"))},0),e},this.closeContent=function(e,t){var a=n.metaReducer.gf(e,"data.openTabs")||(0,o.List)(),r=a.findIndex(function(e){return e.get("name")==t});return a=a.remove(r),e=n.metaReducer.sf(e,"data.openTabs",a),n.metaReducer.sf(e,"data.content",a.get(a.size-1))},this.closeAll=function(e){return e=n.metaReducer.sf(e,"data.openTabs",new o.List),n.metaReducer.sf(e,"data.content",new o.Map)},this.metaReducer=t.metaReducer,this.config=u.default.current};e.exports=t.default},1728:function(e,t,n){e.exports=n.p+"photo.36d29d9e.png"}}]);
//# sourceMappingURL=mk-app-portal.0920bb64.chunk.js.map